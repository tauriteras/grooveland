import{A as L,a as C,b as R,P as y,M as f,D as T,T as u,c as g,V as m,d as W,e as b,f as G,G as A,S,W as J,R as V,C as X,g as H}from"./three-bL-XDhe9.js";import{l as Y}from"./socket.io-client-IQIgtGCP.js";import"./engine.io-client-Uz0TRVm7.js";import"./engine.io-parser-33FB7g9V.js";import"./@socket.io-3-vkxHAM.js";import"./socket.io-parser-QJaHYohl.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function a(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=a(i);fetch(i.href,o)}})();class N{constructor(){this.listener=new L,this.audio=new C(this.listener)}init(t,a){var s=new R,i=new L,o=new C(i);s.load(t,function(r){o.setBuffer(r),o.setLoop(a===void 0?!1:a),o.play()})}}let d={0:{name:"Empty_Block",texture:"../Images/Blocks/transparent.png",type:"Empty_Block",sub_type:"Empty_Block",complexity:0,hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!1,interactable_type:"none"},1:{name:"Bedrock",texture:"../Images/Blocks/bedrock.png",type:"Block",sub_type:"Solid Block",complexity:1,hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!1,interactable:!1,interactable_type:"none"},2:{name:"Dirt",texture:"../Images/Blocks/dirt.png",alt_texture:"../Images/Blocks/dirt2.png",type:"Block",sub_type:"Solid Block",complexity:1,hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},3:{name:"Rock",texture:"../Images/Blocks/rock.png",type:"Block",sub_type:"Solid Block",complexity:1,hardness:6,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},4:{name:"Entry Portal",texture:"../Images/Blocks/entry-portal.png",type:"Block",sub_type:"Door",complexity:1,hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!0,interactable_type:"click"},5:{name:"Sign",texture:"../Images/Blocks/sign.png",type:"Block",sub_type:"Text",complexity:1,hardness:3,punchCount:0,text:"Sample text",collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"settings"},6:{name:"Radio",texture:"../Images/Blocks/radio.png",type:"Block",sub_type:"Music",complexity:1,hardness:10,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"punch"},7:{name:"Cave Background",texture:"../Images/Background blocks/cave_bg.png",type:"Background Block",sub_type:"Background",complexity:1,hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!1,interactable_type:"none"},8:{name:"Bedrock Tree",texture:"../Images/Trees/tree1.png",type:"Block",sub_type:"Tree",complexity:1,timeToGrow:3e4,timePlanted:0,timeLeft:0,hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!1,interactable_type:"none"}};const q=[[1,99999],[2,99999],[3,99999],[4,99999],[5,99999],[6,99999],[7,99999]];class F{constructor(){this.mouseButtonAction="punch",this.inventory=q,this.activeItem=0,this.seedId=0,this.wannaJump=!1,this.jumping=!1,this.hasTouchedGround=!1,this.hasJumped=!1,this.canDoubleJump=!1,this.hasDoubleJumped=!1,this.puncHoldTimer=0,this.punchCooldown=.25,this.sprite=null,this.size={width:.75,height:1},this.position={x:10,y:10,z:.01},this.collisions={left:!1,right:!1,top:!1,bottom:!1},this.velocity=3,this.airTime=0,this.goingLeft=!1,this.goingRight=!1,this.faceCollides=!1,this.facingDirection="",this.clickedElement=null,this.mouseX=0,this.mouseY=0,this.standingon=null,this.audioPlayer=null,this.punchedObjects=[]}create(t){const a=new y(this.size.width,this.size.height),s=new f({side:T,map:new u().load("../Images/Player/player.png"),transparent:!0});let i=new g(a,s);i.position.x=this.position.x,i.position.y=this.position.y,i.position.z=this.position.z,i.renderOrder=100,i.name="Player",i.userData={objectType:"Player",name:t,dateCreated:Date.now()},this.audioPlayer=new N,this.sprite=i,this.name=t,e.player=this}setMousePosition(t){this.mouseX=-1+t.clientX/e.canvas.width*2,this.mouseY=1-t.clientY/e.canvas.height*2}respawn(){this.position.x=e.world.entryPoint.x,this.position.y=e.world.entryPoint.y}jump(){if(this.airTime<3&&this.collisions.top===!1&&this.hasJumped===!1){if(e.delta===0)return;this.jumping=!0,this.airTime+=e.delta,this.position.y+=(4-1*(this.airTime*this.airTime))*e.delta,this.airTime>2&&(this.airTime=0,this.hasJumped=!0,e.physics.gravityStrength=1);return}this.collisions.top===!0&&(this.jumping=!1,this.airTime=0,this.hasJumped=!0,e.physics.gravityStrength=1)}settingsClick(){let t=new b;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.getClickedElement(t),this.clickedElement!==null&&this.clickedElement.userData.objectType==="Block"&&this.clickedElement.userData.interactable===!0&&this.clickedElement.userData.interactable_type==="settings"&&(console.log(this.clickedElement.userData.text),this.clickedElement.userData.interacted===!1&&(this.clickedElement.userData.interacted=!0,e.gui.openTextPopup()))}consume(){let t=new b;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.getClickedElement(t),console.log(this.clickedElement),this.clickedElement!==null&&(this.puncHoldTimer+=e.delta,(this.clickedElement.name="Player")&&this.puncHoldTimer>this.punchCooldown&&(this.audioPlayer.init("../Audio/consume.wav",!1),this.puncHoldTimer=0))}punch(){let t=new b;if(t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.puncHoldTimer+=e.delta,this.puncHoldTimer>this.punchCooldown){if(e.player.audioPlayer.init("../Audio/punch.wav",!1),this.getClickedElement(t),this.puncHoldTimer=0,this.clickedElement===null)return;this.clickedElement.userData.objectType==="Block"&&P(this.clickedElement),this.clickedElement.userData.objectType==="Background Block"&&P(this.clickedElement)}}place(){let t=new b;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.getPlaceableTile(t),this.clickedElement!==null&&(this.clickedElement.position.x===Math.round(e.player.position.x)&&this.clickedElement.position.y===Math.round(e.player.position.y)||this.clickedElement.userData.objectType==="Empty_Block"&&(this.audioPlayer.init("../Audio/place_block.wav",!1),this.clickedElement.userData.hardness=d[this.activeItem].hardness,this.clickedElement.userData.breakable=d[this.activeItem].breakable,this.clickedElement.userData.interactable=d[this.activeItem].interactable,this.clickedElement.userData.interactable_type=d[this.activeItem].interactable_type,this.clickedElement.userData.objectType=d[this.activeItem].type,this.clickedElement.userData.sub_type=d[this.activeItem].sub_type,this.clickedElement.userData.punchCount=0,this.clickedElement.material.visible=!0,this.clickedElement.material.map=new u().load(d[this.activeItem].texture),this.clickedElement.userData.collides=d[this.activeItem].collides))}plant(){let t=new b;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.getPlaceableTile(t),this.clickedElement!==null&&(this.clickedElement.userData.objectType==="Empty_Block"&&(this.audioPlayer.init("../Audio/planting.wav",!1),this.clickedElement.userData.breakable=!0,this.clickedElement.userData.interactable=!0,this.clickedElement.userData.interactable_type="none",this.clickedElement.userData.objectType="Block",this.clickedElement.userData.sub_type="Tree",this.clickedElement.userData.punchCount=0,this.clickedElement.userData.timeToGrow=3e4,this.clickedElement.userData.timePlanted=Date.now(),this.clickedElement.userData.seedID=this.seedId,this.clickedElement.material.map=new u().load("../Images/Trees/tree1.png"),this.clickedElement.material.visible=!0,this.clickedElement.userData.collides={top:!1,bottom:!1,left:!1,right:!1},e.world.growingTrees.push(this.clickedElement),console.log("tree planted",this.clickedElement),console.log("growing trees in world",e.world.growingTrees)),this.clickedElement.userData.seedID===1&&this.seedId===2&&(this.clickedElement.userData.timeToGrow=6e4,this.clickedElement.userData.timePlanted=Date.now(),this.clickedElement.userData.timeGrown=0,this.clickedElement.material.map=new u().load("../Images/Trees/tree-2.png")))}getClickedElement(t){var a=!1;e.raycaster.setFromCamera(t,e.camera);let s=e.raycaster.intersectObjects(e.scene.children);for(let i=0;i<s.length;i++){let o=s[i].object;if(o===void 0)return;this.mouseButtonAction==="consume"&&o.name==="Player"&&this.clickedElement,o.userData.objectType==="Empty_Block"&&(a=!0),this.mouseButtonAction==="punch"&&o.userData.objectType==="Block"&&(this.clickedElement=o),a===!0&&this.mouseButtonAction==="punch"&&o.userData.objectType==="Background Block"&&(this.clickedElement=o)}}getPlaceableTile(t){e.raycaster.setFromCamera(t,e.camera);let a=e.raycaster.intersectObjects(e.scene.children);for(let s=0;s<a.length;s++){let i=a[s].object;if(i.userData.objectType==="Empty_Block"){this.clickedElement=i;return}if(this.mouseButtonAction==="plant"&&(console.log("plant collisions",i),i.userData.sub_type==="Tree")){this.clickedElement=i;return}}}moveLeft(){this.goingLeft=!0,this.goingRight=!1,this.collisions.left===!1&&(this.position.x-=this.velocity*e.delta)}moveRight(){this.goingLeft=!1,this.goingRight=!0,this.collisions.right===!1&&(this.position.x+=this.velocity*e.delta)}standingOn(){let t=new m(this.position.x,this.position.y,this.position.z),a=new m(0,0,-1);e.raycaster.set(t,a);let s=e.raycaster.intersectObjects(e.scene.children);if(s!==void 0)for(let i=0;i<s.length;i++){let o=s[i].object;if(o===void 0)return;o.userData.sub_type==="Text"&&(this.standingon=o)}}}function U(n){if(n.userData.punchCount===0){e.player.punchedObjects.push([n,Date.now()]);const a=new y(1,1),s=new f({transparent:!0});s.map=new u().load("../Images/Breaking/breaking1.PNG");const i=new g(a,s);n.add(i)}n.userData.punchCount+=1;let t=Math.round(n.userData.punchCount/n.userData.hardness*100);t>20&&t<=40&&(n.children[0].material.map=new u().load("../Images/Breaking/breaking2.PNG")),t>40&&t<=60&&(n.children[0].material.map=new u().load("../Images/Breaking/breaking3.PNG")),t>60&&t<=80&&(n.children[0].material.map=new u().load("../Images/Breaking/breaking4.PNG")),t>80&&t<=100&&(n.children[0].material.map=new u().load("../Images/Breaking/breaking5.PNG"))}function Z(n){e.player.audioPlayer.init("../Audio/break_block.wav",!1),n.remove(n.children[0]),n.userData.objectType==="Block"&&(n.userData.objectType="Empty_Block"),n.userData.objectType==="Background Block"&&(n.userData.objectType="Empty_Background_Block"),n.userData.breakable=!1,n.userData.interactable=!1,n.userData.interactable_type="none",n.userData.punchCount=0,n.userData.hardness=3,n.material.map=new u().load("../Images/Blocks/transparent.png"),n.material.visible=!1,n.userData.collides={top:!1,bottom:!1,left:!1,right:!1}}function P(n){if(n.userData.breakable===!1){e.player.audioPlayer.init("../Audio/unbreakable.wav",!1);return}e.player.audioPlayer.init("../Audio/hit_block.wav",!1);for(let t=0;t<e.world.punchedItems.length;t++){if(e.world.punchedItems[t].id===n.id){n.userData.lastPunched=Date.now();return}n.userData.lastPunched=Date.now(),e.world.punchedItems.push(n)}U(n),console.log(e.world.punchedItems),n.userData.punchCount===n.userData.hardness&&(K(n),Z(n))}function K(n){console.log("spawn",n);let t=n.position.x,a=n.position.y,s=Math.floor(Math.random()*100);s<=30||(s>30&&s<=60&&Q(n,t,a),s>60&&$(n,t,a),console.log("spawning drops for ",n,t,a,"randInt",s))}function Q(n,t,a){console.log("spawn seed",n,t,a);const s=new y(.5,.5),i=new f({map:new u().load("../Images/Seeds/dirt_seed.png"),transparent:!0}),o=new g(s,i);let r=z();o.position.x=t+r[0],o.position.y=a+r[1],o.position.z=.1,o.userData.name="seed",e.scene.add(o),e.world.droppedItems.push(o)}function $(n,t,a){const s=new y(.5,.5),i=new f({map:new u().load("../Images/Blocks/dirt.png"),transparent:!0}),o=new g(s,i);let r=z();o.position.x=t+r[0],o.position.y=a+r[1],o.position.z=.1,o.userData.name="dropped_block",e.scene.add(o),e.world.droppedItems.push(o),console.log("dropped",e.world.droppedItems),new W(o),o.animations}function z(){let n=Math.random()*.25,t=Math.random()*.25,a=_(n),s=_(t);return[a,s]}function _(n){return Math.floor(Math.random()*100)%2===0?n*-1:n}class ee{constructor(){this.position={x:0,y:0,z:5},this.zoomingOut=!1,this.zoomingIn=!1}Camera(){const t=new G(75,window.innerWidth/window.innerHeight,.1,1e3);return t.position.x=this.position.x,t.position.y=this.position.y,t.position.z=this.position.z,t.name="Camera",t}updatePos(){let t=e.camera.position.x-e.cameraViewWidth,a=e.camera.position.x+e.cameraViewWidth;t<1.7&&(e.camera.position.x=e.cameraViewWidth+1.7),a>99.45&&(e.camera.position.x=99.4-e.cameraViewWidth),e.player.goingRight&&a<99.3&&(e.camera.position.x<e.player.position.x+(1+e.cameraViewWidth)&&(e.camera.position.x+=4*e.delta),e.camera.position.x===e.player.position.x+(1+e.cameraViewWidth)&&(e.camera.position.x+=e.player.velocity*e.delta)),e.player.goingLeft&&t>2&&(e.camera.position.x>e.player.position.x-(1+e.cameraViewWidth)&&(e.camera.position.x-=4*e.delta),e.camera.position.x===e.player.position.x-(1+e.cameraViewWidth)&&(e.camera.position.x-=e.player.velocity*e.delta)),!e.player.goingRight&&!e.player.goingLeft&&(e.camera.position.x>e.player.position.x&&t>1.8&&(e.camera.position.x-=2*e.delta),e.camera.position.x<e.player.position.x&&a<99.3&&(e.camera.position.x+=2*e.delta)),e.camera.position.y=e.player.position.y}}class te{constructor(){this.width=1,this.height=1}create(){const t=new y(this.width,this.height),a=new f({side:T,transparent:!0}),s=new g(t,a);return s.position.z=.001,s.name="Block",s}}class ie{constructor(){this.width=1,this.height=1}create(t){const a=new y(this.width,this.height),s=new f({side:T,transparent:!0}),i=new g(a,s);return t===0&&(s.opacity=0,i.userData.hardness=3,i.userData.punchCount=0,i.userData.breakable=!1,i.userData.interactable="false",i.userData.interactable_type="none",i.userData.objectType="Empty_Background_Block",i.userData.sub_type="Background",i.userData.collides={top:!1,bottom:!1,left:!1,right:!1}),t===7&&(s.map=new u().load(d[t].texture),i.userData.hardness=d[t].hardness,i.userData.punchCount=d[t].punchCount,i.userData.breakable=d[t].breakable,i.userData.interactable=d[t].interactable,i.userData.interactable_type=d[t].interactable_type,i.userData.objectType=d[t].type,i.userData.sub_type=d[t].sub_type,i.userData.collides=d[t].collides),i.position.x=50,i.position.y=30,i.position.z=-1e-4,i.name="Background Block",i}}class ae{constructor(){this.growingTrees=[],this.grownTrees=[],this.loaded=!1,this.startedloading=!1,this.dataIsLoaded=!1,this.width=100,this.height=56,this.entryPoint={x:0,y:0},this.blocks=[],this.backgroundBlocks=[],this.droppedItems=[],this.punchedItems=[]}unpackWorldDataAndThenLoad(t){for(let a=0;a<t.length;a++)e.world.blocks.push(t[a][0]),e.world.backgroundBlocks.push(t[a][1]);this.load()}load(){ne(),oe(this.blocks),se(this.backgroundBlocks),this.isLoaded=!0,e.player.position.x=this.entryPoint.x,e.player.position.y=this.entryPoint.y,e.scene.add(e.player.sprite),e.gui.load(),e.camera.position.x=e.player.position.x,e.camera.position.y=e.player.position.y+1.5}}function ne(){if(e.scene===void 0)return;const n=new y(105,65),t=new f({map:new u().load("../Images/background.png")}),a=new g(n,t);a.position.x=50,a.position.y=30,a.position.z=-1e-4,a.name="Background",e.scene.add(a)}function se(n){const t=new A;t.name="BackgroundBlockGroup";let a=0,s=0;for(let i=0;i<n.length;i++){const o=new ie;let r=n[i],p=o.create(r);p.position.x=a,p.position.y=s,t.add(p),a+=1,a%e.world.width===0&&(a=0,s+=1)}e.scene.add(t)}function oe(n){if(e.scene===void 0)return;const t=new A;t.name="BlockGroup";let a=0,s=0;for(let i=0;i<n.length;i++){const o=new te;let r=n[i],p=o.create(r);p.position.x=a,p.position.y=s,p.userData.hardness=d[r].hardness,p.userData.punchCount=d[r].punchCount,p.userData.breakable=d[r].breakable,p.userData.interactable=d[r].interactable,p.userData.interactable_type=d[r].interactable_type,p.userData.interacted=!1,p.material.map=new u().load(d[r].texture),p.userData.name=d[r].name,p.userData.objectType=d[r].type,p.userData.sub_type=d[r].sub_type,p.userData.collides=d[r].collides,d[r].sub_type==="Text"&&(p.userData.text=d[r].text),r===4&&(e.world.entryPoint.x=a,e.world.entryPoint.y=s),r===0&&(p.material.visible=!1),t.add(p),a+=1,a%e.world.width===0&&(a=0,s+=1),e.scene.add(t)}}class re{constructor(){this.gravityStrength=1}update(){e.player===void 0||e.player===null||(ue(),pe(),ce(),de(),le(),!e.player.collisions.bottom&&e.player.jumping===!1&&(e.player.position.y-=.2+e.physics.gravityStrength*(e.player.airTime*e.player.airTime)*e.delta),e.player.collisions.bottom&&(e.player.position.y<4&&(e.player.position.y=4),e.player.position.y=Math.round(e.player.position.y)))}}function le(){if(e.world.isLoaded===!1)return;let n=new m(e.player.position.x,e.player.position.y,e.player.position.z),t=new m(0,0,-1);e.raycaster.set(n,t);let a=e.raycaster.intersectObjects(e.scene.children);for(let s=0;s<a.length;s++){let i=a[s].object;i.userData.objectType==="Block"&&i.userData.collides.top===!0&&i.userData.collides.bottom===!0&&i.userData.collides.left===!0&&i.userData.collides.right===!0&&e.player.respawn()}}function ce(){if(e.world.isLoaded===!1)return;let n=new m(e.player.position.x-e.player.size.width/2,e.player.position.y,e.player.position.z),t=new m(0,0,-1);e.raycaster.set(n,t);let a=e.raycaster.intersectObjects(e.scene.children);for(let s=0;s<a.length;s++){let i=a[s].object;if(i.userData.objectType==="Block"&&i.userData.collides.right===!0){e.player.collisions.left=!0;return}e.player.collisions.left=!1}}function de(){if(e.world.isLoaded===!1)return;let n=new m(e.player.position.x+e.player.size.width/2,e.player.position.y,e.player.position.z),t=new m(0,0,-1);e.raycaster.set(n,t);let a=e.raycaster.intersectObjects(e.scene.children);for(let s=0;s<a.length;s++){let i=a[s].object;if(i.userData.objectType==="Block"){i.userData.collides.left===!0&&(e.player.collisions.right=!0);return}}e.player.collisions.right=!1}function pe(){if(e.world.isLoaded===!1){e.player.collisions.bottom=!0;return}let n=new m(e.player.position.x,e.player.position.y-e.player.size.height/2,e.player.position.z),t=new m(0,0,-1);e.raycaster.set(n,t);let a=e.raycaster.intersectObjects(e.scene.children);if(a===void 0||a.length===0)return;let s=[];for(let i=0;i<a.length;i++){let o=a[i].object;if(o===void 0)return;o.name==="Block"&&s.push(e.scene.getObjectById(o.id))}if(s!==void 0){if(s.length>0)for(let i=0;i<s.length;i++){let o=s[i];if(o===void 0)return;if(o.userData.objectType==="Block"&&o.userData.collides.top===!0){e.player.hasTouchedGround=!0,e.player.collisions.bottom=!0,e.player.airTime=0;return}}e.player.collisions.bottom=!1,e.player.airTime+=e.delta}}function ue(){if(e.world.isLoaded===!1)return;let n=new m(e.player.position.x,e.player.position.y+e.player.size.height/2,e.player.position.z),t=new m(0,0,-1);e.raycaster.set(n,t);let a=e.raycaster.intersectObjects(e.scene.children);for(let s=0;s<a.length;s++){let i=a[s].object;if(i.userData.objectType==="Block"){i.userData.collides.bottom===!0&&(e.player.collisions.top=!0);return}}e.player.collisions.top=!1}class me{constructor(){}load(){console.log("loading gui"),he()}openTextPopup(){let t=document.getElementById("body"),a=document.createElement("div");a.classList.add("popup"),a.id="popup";let s=document.createElement("input");s.type="text",s.value=e.player.clickedElement.userData.text;let i=document.createElement("button");i.id="popup_close",i.innerHTML="Close",i.addEventListener("click",o=>{let r=o.target.parentElement,p=document.getElementById("body");console.log(r,p,r.children),e.player.clickedElement.userData.text=r.children[0].value,console.log(r.children[0].value),e.player.clickedElement.userData.interacted=!1,p.removeChild(r)}),a.appendChild(s),a.appendChild(i),t.appendChild(a)}}function he(n){let t=document.getElementById("inventory"),a=document.getElementById("inventory").children,s=document.getElementById("punch"),i=document.getElementById("settings"),o=document.getElementById("plant"),r=document.getElementById("plant2");document.getElementById("consume").addEventListener("click",c=>{for(let l=0;a.length>l;l++)a[l].classList.contains("active")&&a[l].classList.remove("active");c.target.classList.contains("inventory_img")?c.target.parentElement.classList.add("active"):c.target.classList.add("active"),e.player.mouseButtonAction="consume",e.player.activeItem=0}),s.addEventListener("click",c=>{for(let l=0;a.length>l;l++)a[l].classList.contains("active")&&a[l].classList.remove("active");c.target.classList.contains("inventory_img")?c.target.parentElement.classList.add("active"):c.target.classList.add("active"),e.player.mouseButtonAction="punch",e.player.activeItem=0}),i.addEventListener("click",c=>{for(let l=0;a.length>l;l++)a[l].classList.contains("active")&&a[l].classList.remove("active");c.target.classList.contains("inventory_img")?c.target.parentElement.classList.add("active"):c.target.classList.add("active"),e.player.mouseButtonAction="settings",e.player.activeItem=0}),o.addEventListener("click",c=>{for(let h=0;a.length>h;h++)a[h].classList.contains("active")&&a[h].classList.remove("active");let l;c.target.classList.contains("inventory_img")?(l=c.target.parentElement,c.target.parentElement.classList.add("active")):(l=c.target,c.target.classList.add("active")),l.dataset.invBtnItem==="seed"&&(e.player.mouseButtonAction="place",e.player.seedId=parseInt(l.dataset.invBtnItemId),console.log("seed ID",e.player.seedId)),e.player.mouseButtonAction="plant"}),r.addEventListener("click",c=>{for(let h=0;a.length>h;h++)a[h].classList.contains("active")&&a[h].classList.remove("active");let l;c.target.classList.contains("inventory_img")?(l=c.target.parentElement,c.target.parentElement.classList.add("active")):(l=c.target,c.target.classList.add("active")),l.dataset.invBtnItem==="seed"&&(e.player.mouseButtonAction="place",e.player.seedId=parseInt(l.dataset.invBtnItemId),console.log("seed ID",e.player.seedId)),e.player.mouseButtonAction="plant"});for(let c=0;e.player.inventory.length>c;c++){console.log(e.player.inventory[c]);let l=document.createElement("div");l.classList.add("inventory_tile"),l.classList.add("blocks");let h=document.createElement("img");h.src=d[e.player.inventory[c][0]].texture,h.classList.add("inventory_img");let E=document.createElement("p");E.innerHTML=e.player.inventory[c][1],E.classList.add("item-count"),l.appendChild(h),l.appendChild(E),l.dataset.invBtnItem=d[e.player.inventory[c][0]].type,l.dataset.invBtnItemId=e.player.inventory[c][0],l.addEventListener("click",w=>{let x=document.getElementById("inventory").children;for(let v=0;x.length>v;v++)x[v].classList.contains("active")&&x[v].classList.remove("active");console.log(w.target);let k;w.target.classList.contains("inventory_img")?(k=w.target.parentElement,w.target.parentElement.classList.add("active")):(k=w.target,w.target.classList.add("active")),console.log("item",k.dataset.invBtnItem),console.log("itemId",k.dataset.invBtnItemId),k.dataset.invBtnItem==="Block"&&(e.player.mouseButtonAction="place",e.player.activeItem=k.dataset.invBtnItemId),console.log("player",e.player.mouseButtonAction,e.player.activeItem)}),t.appendChild(l)}t.style.opacity=1}const B=new S,M=new ee,D=new J;D.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(D.domElement);let O=document.querySelector("canvas");const ye=new H,fe=new F;var e;let ge="http://localhost:3069";class we{constructor(){this.game=null,this.canvas=O,this.cameraViewWidth=0,this.delta=0,this.gui=null,this.server=null,this.connected=!1}init(){const t=new re;this.physics=t,this.camera=M.Camera();const a=new V;this.raycaster=a;const s=Y(ge);this.server=s,this.world=new ae,this.scene=B,B.add(this.camera),e.server.on("connect",()=>{console.log("connected"),e.connected=!0,e.server.on("returnWorld",i=>{console.log(i),fe.create("@dev");let o=new me;this.gui=o,e.world.unpackWorldDataAndThenLoad(i)})}),I()}}document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("request-world-data",()=>{console.log("req world");let t=document.getElementById("worldname-input").value;console.log(t),e.server.emit("getWorld",t)}),e=new we,e.game=e,console.log(e),e.init()});document.addEventListener("keydown",n=>{let t=n.key.toUpperCase();(t==="W"||t===" ")&&e.player.wannaJump===!1&&(e.physics.gravityStrength=0,e.player.wannaJump=!0),t==="D"&&(e.player.facingDirection=new m(1,0,0),e.player.goingRight=!0),t==="A"&&(e.player.facingDirection=new m(-1,0,0),e.player.goingLeft=!0),t==="S"&&(e.player.position.y-=1),t==="X"&&(e.camera.zoomingOut=!0),t==="Z"&&(e.camera.zoomingIn=!0)});document.addEventListener("keyup",n=>{let t=n.key.toUpperCase();if((t==="W"||t===" ")&&(e.player.jumping=!1,e.player.wannaJump=!1,e.player.hasJumped=!1,e.physics.gravityStrength=1,e.player.airTime=0),t==="P"){if(e.player.mouseButtonAction==="punch"){e.player.mouseButtonAction="place",console.log("place");return}if(e.player.mouseButtonAction==="place"){e.player.mouseButtonAction="plant",console.log("plant");return}if(e.player.mouseButtonAction==="plant"){e.player.mouseButtonAction="punch",console.log("punch");return}}t==="R"&&e.player.respawn(),t==="D"&&(e.player.goingRight=!1),t==="A"&&(e.player.goingLeft=!1),t==="X"&&(e.camera.zoomingOut=!1),t==="Z"&&(e.camera.zoomingIn=!1)});O.addEventListener("pointermove",n=>{e.player!==void 0&&e.player.setMousePosition(n)});document.addEventListener("pointerdown",n=>{e.player!==void 0&&(e.player.holdingMouseRight=!0)});document.addEventListener("pointerup",n=>{e.player!==void 0&&(e.player.holdingMouseRight=!1,e.player.puncHoldTimer=0)});window.onresize=function(){e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix(),e.renderer.setSize(window.innerWidth,window.innerHeight)};function I(){if(e.delta=ye.getDelta(),!e.world.isLoaded||e.player===void 0){requestAnimationFrame(I),D.render(B,e.camera);return}if(e.world.isLoaded&&e.world.growingTrees.length>0)for(let n=0;n<e.world.growingTrees.length;n++){let t=e.world.growingTrees[n],a=Date.now();t.userData.timeGrown=a-t.userData.timePlanted;let s=Math.round(t.userData.timeGrown/t.userData.timeToGrow*100);s===20&&(t.material.map=new u().load("../Images/Trees/tree2.png")),s===40&&(t.material.map=new u().load("../Images/Trees/tree3.png")),s===60&&(t.material.map=new u().load("../Images/Trees/tree4.png")),s===80&&(t.material.map=new u().load("../Images/Trees/tree5.png")),s===100&&(t.material.color=new X(65280),t.userData.hardness=1,e.world.growingTrees.splice([n],1),e.world.grownTrees.push(t))}e.physics.update(),e.player.goingRight&&e.player.position.x<99.25&&e.player.moveRight(),e.player.goingLeft&&e.player.position.x>-.1&&e.player.moveLeft(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="punch"&&e.player.punch(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="place"&&e.player.place(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="plant"&&e.player.plant(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="settings"&&e.player.settingsClick(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="consume"&&e.player.consume(),e.player.wannaJump&&(e.player.hasJumped===!1&&e.player.jump(),e.player.hasJumped===!0&&(e.player.jumping=!1)),e.camera.zoomingIn===!0&&(j(),e.camera.position.z>2&&(e.camera.position.z-=5*e.delta)),e.camera.zoomingOut===!0&&e.camera.position.z<8&&(e.camera.position.z+=5*e.delta),be(),ke(),j(),M.updatePos(),e.player.sprite.position.x=e.player.position.x,e.player.sprite.position.y=e.player.position.y,e.player.standingOn(),requestAnimationFrame(I),D.render(B,e.camera)}function j(){e.cameraViewWidth=e.camera.position.z+Math.tan(37.5)*e.camera.position.z}function ke(){for(let n=0;n<e.world.droppedItems.length;n++){if(Math.floor(Math.random()*100)%2===0){e.world.droppedItems[n].position.y+=1*e.delta;return}e.world.droppedItems[n].position.y-=1*e.delta}}function be(){let n=new m(e.player.position.x,e.player.position.y,1),t=new m(0,0,-1);e.raycaster.set(n,t);let a=e.raycaster.intersectObjects(e.scene.children);console.log(a)}
